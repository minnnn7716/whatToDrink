import{y as d,z as h,m as f,_ as u,r as g,o as _,c as y,a as r,t as m,b as D,p as R,e as v}from"./index-1daaf648.js";import{R as x}from"./RateDisplay-af776b40.js";import{_ as S}from"./userPhoto-8e961c51.js";const C=d("commentStore",{state:()=>({comments:[],rateGroup:{},pinRate:!1,pagination:{},sortComments:[]}),actions:{getComments(){const t="https://what-to-drink-api-vercel.vercel.app/comments";h.get(t).then(e=>{console.log(e),this.comments=e.data}).catch(e=>{console.log(e)})},clickPin(t){if(this.pinRate===t){this.pinRate=!1;return}this.pinRate=t},getRateGroupInfo(t){if(t){const e=t.length,s=this.totalRateScore(t),a=[];for(let n=1;n<=5;n+=1)a.push(this.eachRateLength(t,n));this.rateGroup={commentsNum:e,totalRateScore:s,eachRateNum:a}}},eachRateLength(t,e){return t.filter(s=>+s.rate===e).length},totalRateScore(t){let e="0";if(t.length){const s=t.map(a=>+a.rate);e=(s.reduce((a,n)=>a+n,0)/s.length).toFixed(1)}return e},filterUserComment(t){return[...this.comments].filter(s=>s.userName===t)},sortFn(t,e,s){let a=[];return e==="down"?a=t.sort((n,o)=>o[s]-n[s]):e==="up"&&(a=t.sort((n,o)=>n[s]-o[s])),a},sortSpecifyFn(t,e,s){const a=[];let n=[];for(let o=0;o<e.length;o+=1){let i=t.filter(c=>c[s]===e[o]);i=i.sort((c,l)=>l.rate-c.rate),a.push(i)}return n=a.reduce((o,i)=>o.concat(i),[]),n},sortCommentsFn(t,e,s=1){this.sort=e,this.currentCommentData=t;let a=[],n=[],o=[];if(this.pinRate?n=t.filter(i=>+i.rate===this.pinRate):n=t,e==="最新日期"&&(a=this.sortFn(n,"down","date")),e==="評分最高"&&(a=this.sortFn(n,"down","rate")),e==="最冰溫度"){const i=["多冰","少冰","半冰","微冰","去冰","完全去冰","溫","熱","不記得"];a=this.sortSpecifyFn(n,i,"ice")}if(e==="最少甜度"){const i=["無糖","1 分糖","微糖","半糖","少糖","全糖","多糖","不記得"];a=this.sortSpecifyFn(n,i,"sugar")}o=this.slicePage(a,s),this.sortComments=o},postComment(t){const e="https://what-to-drink-api-vercel.vercel.app/comments";h.post(e,t).then(s=>{console.log(s)}).catch(s=>{console.log(s)})},slicePage(t,e=1){let s=[];if(t){const n=parseInt(t.length/6,10),o=t.length%6,i=o!==0;let c=null;o?c=n+1:c=n;const l={data:t,pageLimit:6,sliceNum:c,hasRemainder:i,currentPage:e};s=this.sliceFn(l)[e-1]}return s},sliceFn(t){const{data:e,pageLimit:s,sliceNum:a,hasRemainder:n,currentPage:o}=t,i=[];let c=0;for(let l=0;l<a;l+=1){let p=[];n&&a===l?p=e.slice(c):p=e.slice(c,c+s),i.push(p),c+=s}return this.pagination={total:i.length,current:o,prev:o>1,next:o<i.length},i},clickPage(t){let e=this.pagination.current;const s=this.pagination.total;typeof t=="number"?e=t:t==="prev"?e-=1:t==="next"&&(e+=1),this.pagination={...this.pagination,current:e,prev:e>1,next:e<s}}}});const w={components:{RateDisplay:x},props:{commentData:{type:Object,default(){return{}}}},methods:{...f(C,["filterUserComment"]),getDate(t){return new Date(t).toLocaleDateString()}}},A=t=>(R("data-v-119d18a9"),t=t(),v(),t),b={class:"pt-6 flex-grow-1"},F={class:"commentDisplay h-100"},L=A(()=>r("div",{class:"commentDisplay-userPhoto"},[r("img",{class:"img-fluid",src:S,alt:"使用者頭像"})],-1)),N={class:"commentDisplay-header mb-4 d-flex justify-content-between"},k={class:"d-inline-block px-2 mb-1 bg-white"},I={class:"px-2 fs-normal2"},P={class:"px-2 fs-normal2"},B={class:"bg-white px-2"},G={class:"fs-normal2 text-end"},U=["innerHTML"];function j(t,e,s,a,n,o){const i=g("RateDisplay");return _(),y("div",b,[r("div",F,[L,r("div",N,[r("div",null,[r("h5",k,m(s.commentData.userName),1),r("p",I,m(t.filterUserComment(s.commentData.userName).length)+" 則評論",1),r("time",P,m(o.getDate(s.commentData.date)),1)]),r("div",B,[D(i,{rate:s.commentData.rate,class:"rateDisplay-sm mb-1"},null,8,["rate"]),r("p",G,m(s.commentData.sugar)+" / "+m(s.commentData.ice),1)])]),r("p",{class:"commentDisplay-content px-2",innerHTML:s.commentData.content},null,8,U)])])}const V=u(w,[["render",j],["__scopeId","data-v-119d18a9"]]);export{V as C,C as c};
