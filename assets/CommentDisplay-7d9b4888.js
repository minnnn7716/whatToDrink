import{y as d,z as u,A as p,m as g,_ as f,r as _,o as y,c as D,a as c,t as m,d as v,p as R,f as x}from"./index-b93c5667.js";import{R as N}from"./RateDisplay-55162780.js";const b=d("commentStore",{state:()=>({comments:[],rateGroup:{},pinRate:!1,pagination:{},sortComments:[]}),actions:{getComments(){const t="https://what-to-drink-api-vercel.vercel.app/comments";u.get(t).then(e=>{this.comments=e.data}).catch(()=>{p.emit("push-message",{style:"danger",title:"取得評論失敗",content:"出現系統問題，請聯絡管理員，謝謝！"})})},clickPin(t){if(this.pinRate===t){this.pinRate=!1;return}this.pinRate=t},getRateGroupInfo(t){if(t){const e=t.length,s=this.totalRateScore(t),a=[];for(let n=1;n<=5;n+=1)a.push(this.eachRateLength(t,n));this.rateGroup={commentsNum:e,totalRateScore:s,eachRateNum:a}}},eachRateLength(t,e){return t.filter(s=>+s.rate===e).length},totalRateScore(t){let e="0";if(t.length){const s=t.map(a=>+a.rate);e=(s.reduce((a,n)=>a+n,0)/s.length).toFixed(1)}return e},filterUserComment(t){return[...this.comments].filter(s=>s.userName===t)},sortFn(t,e,s){let a=[];return e==="down"?a=t.sort((n,i)=>i[s]-n[s]):e==="up"&&(a=t.sort((n,i)=>n[s]-i[s])),a},sortSpecifyFn(t,e,s){const a=[];let n=[];for(let i=0;i<e.length;i+=1){let o=t.filter(r=>r[s]===e[i]);o=o.sort((r,l)=>l.rate-r.rate),a.push(o)}return n=a.reduce((i,o)=>i.concat(o),[]),n},sortCommentsFn(t,e,s=1){this.sort=e,this.currentCommentData=t;let a=[],n=[],i=[];if(this.pinRate?n=t.filter(o=>+o.rate===this.pinRate):n=t,e==="最新日期"&&(a=this.sortFn(n,"down","date")),e==="評分最高"&&(a=this.sortFn(n,"down","rate")),e==="最冰溫度"){const o=["多冰","少冰","半冰","微冰","去冰","完全去冰","溫","熱","不記得"];a=this.sortSpecifyFn(n,o,"ice")}if(e==="最少甜度"){const o=["無糖","1 分糖","微糖","半糖","少糖","全糖","多糖","不記得"];a=this.sortSpecifyFn(n,o,"sugar")}i=this.slicePage(a,s),this.sortComments=i},postComment(t,e,s){const a="https://what-to-drink-api-vercel.vercel.app/comments",n=this.rateAverage(s,t.rate),i=this.rateAverage(e,t.rate);u.post(a,t).then(o=>{o.status===201&&(p.emit("push-message",{style:"success",title:"評論成功"}),this.patchRate("shops",n),this.patchRate("drinks",i),this.getComments())}).catch(()=>{p.emit("push-message",{style:"danger",title:"評論失敗",content:"出現系統問題，請聯絡管理員，謝謝！"})})},slicePage(t,e=1){let s=[];if(t){const n=parseInt(t.length/6,10),i=t.length%6,o=i!==0;let r=null;i?r=n+1:r=n;const l={data:t,pageLimit:6,sliceNum:r,hasRemainder:o,currentPage:e};s=this.sliceFn(l)[e-1]}return s},sliceFn(t){const{data:e,pageLimit:s,sliceNum:a,hasRemainder:n,currentPage:i}=t,o=[];let r=0;for(let l=0;l<a;l+=1){let h=[];n&&a===l?h=e.slice(r):h=e.slice(r,r+s),o.push(h),r+=s}return this.pagination={total:o.length,current:i,prev:i>1,next:i<o.length},o},clickPage(t){let e=this.pagination.current;const s=this.pagination.total;typeof t=="number"?e=t:t==="prev"?e-=1:t==="next"&&(e+=1),this.pagination={...this.pagination,current:e,prev:e>1,next:e<s}},patchRate(t,e){const s=`https://what-to-drink-api-vercel.vercel.app/${t}/${e.id}`,a={rate:e.rate,rateNum:e.rateNum};u.patch(s,a).then(()=>{}).catch(()=>{p.emit("push-message",{style:"danger",title:"評論更新失敗",content:"出現系統問題，請聯絡管理員，謝謝！"})})},rateAverage(t,e){const s=((Number(t.rate)*t.rateNum+Number(e))/(t.rateNum+1)).toFixed(1);return{id:t.id,rateNum:t.rateNum+1,rate:`${s}`}}}}),A="/whatToDrink/assets/userPhoto-bc58c883.webp";const S={components:{RateDisplay:N},props:{commentData:{type:Object,default(){return{}}}},methods:{...g(b,["filterUserComment"]),getDate(t){return new Date(t).toLocaleDateString()}}},w=t=>(R("data-v-11770538"),t=t(),x(),t),C={class:"pt-6 w-100 h-100"},k={class:"commentDisplay h-100"},F=w(()=>c("div",{class:"commentDisplay-userPhoto"},[c("img",{class:"img-fluid",src:A,alt:"使用者頭像"})],-1)),L={class:"commentDisplay-header mb-4 d-flex justify-content-between"},P={class:"d-inline-block px-2 mb-1 bg-white"},I={class:"px-2 fs-normal2"},j={class:"px-2 fs-normal2"},B={class:"bg-white px-2"},G={class:"fs-normal2 text-end"},O=["innerHTML"];function T(t,e,s,a,n,i){const o=_("RateDisplay");return y(),D("div",C,[c("div",k,[F,c("div",L,[c("div",null,[c("h5",P,m(s.commentData.userName),1),c("p",I,m(t.filterUserComment(s.commentData.userName).length)+" 則評論",1),c("time",j,m(i.getDate(s.commentData.date)),1)]),c("div",B,[v(o,{rate:s.commentData.rate,class:"rateDisplay-sm mb-1"},null,8,["rate"]),c("p",G,m(s.commentData.sugar)+" / "+m(s.commentData.ice),1)])]),c("p",{class:"commentDisplay-content px-2",innerHTML:s.commentData.content},null,8,O)])])}const M=f(S,[["render",T],["__scopeId","data-v-11770538"]]);export{M as C,b as c};
